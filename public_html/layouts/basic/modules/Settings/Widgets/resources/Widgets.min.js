'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) {
  return typeof obj;
} : function (obj) {
  return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
};

jQuery.Class('Settings_Widgets_Index_Js',{},{getTabId:function getTabId(){return $('.WidgetsManage [name=\'tabid\']').val()},getType:function getType(){return $('.form-modalAddWidget [name=\'type\']').val()},createStep2:function createStep2(type){var thisInstance=this,tabId=thisInstance.getTabId(),progressIndicatorElement=jQuery.progressIndicator({position:'html'});app.showModalWindow(null,'index.php?parent=Settings&module=Widgets&view=Widget&mode=createStep2&type='+type+'&tabId='+tabId,function(wizardContainer){app.showPopoverElementView(wizardContainer.find('.js-help-info')),'RelatedModule'===type&&(thisInstance.loadFilters(wizardContainer),thisInstance.relatedModuleFields(wizardContainer),wizardContainer.find('select[name=\'relatedmodule\']').on('change',function(){thisInstance.changeRelatedModule(),thisInstance.relatedModuleFields(wizardContainer);})),progressIndicatorElement.progressIndicator({mode:'hide'});var form=jQuery('form',wizardContainer);form.on('submit',function(e){e.preventDefault();var save=!0;if(form&&form.hasClass('validateForm')&&0<form.data('jqv').InvalidFields.length&&(app.formAlignmentAfterValidation(form),save=!1),save){var formData=form.serializeFormData();thisInstance.registerSaveEvent('saveWidget',{data:formData,tabid:tabId}),thisInstance.reloadWidgets(),app.hideModalWindow();}});});},loadWidgets:function loadWidgets(){var thisInstance=this,blocks=jQuery('.blocksSortable');blocks.sortable({revert:!0,connectWith:'.blocksSortable',tolerance:'pointer',cursor:'move',placeholder:'state-highlight',stop:function stop(){thisInstance.updateSequence();}});},updateSequence:function updateSequence(){var thisInstance=this,params={};$('.blockSortable').each(function(index){params[$(this).data('id')]={index:index,column:$(this).closest('.blocksSortable').data('column')};});var progress=$.progressIndicator({message:app.vtranslate('Saving changes'),blockInfo:{enabled:!0}});thisInstance.registerSaveEvent('updateSequence',{data:params,tabid:$('input[name=\'tabid\']').val()}),progress.progressIndicator({mode:'hide'});},reloadWidgets:function reloadWidgets(){var thisInstance=this,Indicator=jQuery.progressIndicator({message:app.vtranslate('Loading data'),position:'html',blockInfo:{enabled:!0}}),params={};params.module='Widgets',params.view='Index',params.parent='Settings',params.source=$('input[name=\'tabid\']').val(),AppConnector.request(params).done(function(data){var container=jQuery('div.contentsDiv').html(data);thisInstance.registerEvents(container),Indicator.progressIndicator({mode:'hide'});});},registerSaveEvent:function registerSaveEvent(mode,data){var params={};params.data={module:app.getModuleName(),parent:app.getParentModuleName(),action:'SaveAjax',mode:mode,params:data},params.async='saveWidget'!=mode,params.dataType='json',AppConnector.request(params).done(function(data){var response=data.result,params={text:response.message,type:'success'};Vtiger_Helper_Js.showPnotify(params);});},loadFilters:function loadFilters(contener){var types=['filter','checkbox','switchHeader'],relatedmodule=contener.find('select[name=\'relatedmodule\'] option:selected').val();for(var i in types){var filters=app.getMainParams(types[i]+'All',!0),filterField=contener.find('select[name=\''+types[i]+'\']'),filterSelected=contener.find('input#'+types[i]+'_selected').val();filterField.empty(),filterField.append($('<option/>',{value:'-',text:app.vtranslate('None')})),filters[relatedmodule]===void 0?filterField.closest('.form-group').addClass('d-none'):(filterField.closest('.form-group').removeClass('d-none'),$.each(filters[relatedmodule],function(index,value){'object'===('undefined'==typeof value?'undefined':_typeof(value))&&(value=value.label);var option={value:index,text:value};filterSelected==index&&(option.selected='selected'),filterField.append($('<option/>',option));}),App.Fields.Picklist.showSelect2ElementView(filterField));}},relatedModuleFields:function relatedModuleFields(container){var relatedModule=parseInt(container.find('select[name=\'relatedmodule\']').val()),relatedfields=container.find('select[name=\'relatedfields\']');relatedfields.find('optgroup').each(function(index,optgroup){optgroup=$(optgroup),relatedModule===optgroup.data('module')?(optgroup.removeClass('d-none'),optgroup.prop('disabled',!1)):(optgroup.addClass('d-none'),optgroup.prop('disabled','disabled')),optgroup.find('option').each(function(index,option){option=$(option),relatedModule===option.data('module')?(option.removeClass('d-none'),option.prop('disabled',!1)):(option.addClass('d-none'),option.prop('disabled','disabled'));});}),relatedfields.trigger('change:select2');},changeRelatedModule:function changeRelatedModule(){var thisInstance=this,form=jQuery('.form-modalAddWidget');thisInstance.loadFilters(form);},registerEvents:function registerEvents(container){var thisInstance=this;this.loadWidgets(),'undefined'==typeof container&&(container=jQuery('.WidgetsManage')),App.Fields.Picklist.showSelect2ElementView(container.find('.select2')),container.find('select.js-module__list').on('change',function(e){var target=$(e.currentTarget);$('input[name=\'tabid\']').val(target.val()),thisInstance.reloadWidgets();}),container.find('.js-widget__add').on('click',function(){var progressIndicatorElement=jQuery.progressIndicator({position:'html'}),module=$('.WidgetsManage select.js-module__list').val();app.showModalWindow(null,'index.php?parent=Settings&module=Widgets&view=Widget&mod='+module,function(wizardContainer){progressIndicatorElement.progressIndicator({mode:'hide'});var form=jQuery('form',wizardContainer);form.on('submit',function(e){e.preventDefault();var type=form.find('[name="type"]').val();thisInstance.createStep2(type);});});}),container.find('.js-widget__edit').on('click',function(e){var target=$(e.currentTarget),blockSortable=target.closest('.blockSortable');app.showModalWindow(null,'index.php?parent=Settings&module=Widgets&view=Widget&mode=edit&id='+blockSortable.data('id'),function(wizardContainer){jQuery('#massEditHeader.modal-title').text(app.vtranslate('JS_EDIT_WIDGET')),app.showPopoverElementView(wizardContainer.find('.js-help-info')),'RelatedModule'==thisInstance.getType()&&(thisInstance.loadFilters(wizardContainer),thisInstance.relatedModuleFields(wizardContainer),wizardContainer.find('select[name=\'relatedmodule\']').on('change',function(){thisInstance.changeRelatedModule(),thisInstance.relatedModuleFields(wizardContainer);}));var form=jQuery('form',wizardContainer);form.on('submit',function(e){e.preventDefault();var progress=$.progressIndicator({message:app.vtranslate('Loading data'),blockInfo:{enabled:!0}}),FormData=form.serializeFormData();thisInstance.registerSaveEvent('saveWidget',{data:FormData,tabid:$('input[name=\'tabid\']').val()}),thisInstance.reloadWidgets(),app.hideModalWindow(),progress.progressIndicator({mode:'hide'});});});}),container.find('.js-widget__remove').on('click',function(e){var target=$(e.currentTarget),blockSortable=target.closest('.blockSortable');thisInstance.registerSaveEvent('removeWidget',{wid:blockSortable.data('id')}),thisInstance.reloadWidgets();});}});
//# sourceMappingURL=Widgets.min.js.map
