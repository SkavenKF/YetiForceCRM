'use strict';

Settings_PDF_Edit_Js("Settings_PDF_Edit1_Js",{},{init:function init(){this.initialize();},getContainer:function getContainer(){return this.step1Container},setContainer:function setContainer(element){return this.step1Container=element,this},initialize:function initialize(container){"undefined"==typeof container&&(container=jQuery("#pdf_step1")),container.is("#pdf_step1")?this.setContainer(container):this.setContainer(jQuery("#pdf_step1"));},submit:function submit(){var aDeferred=jQuery.Deferred(),form=this.getContainer(),formData=form.serializeFormData();formData.async=!1;var progressIndicatorElement=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}}),saveData=form.serializeFormData();return saveData.action="Save",saveData.step=1,saveData.async=!1,AppConnector.request(saveData).done(function(data){if(data=JSON.parse(data),!0==data.success){Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate("JS_PDF_SAVED_SUCCESSFULLY")});var pdfRecordElement=jQuery("[name=\"record\"]",form);""===pdfRecordElement.val()&&(pdfRecordElement.val(data.result.id),formData.record=data.result.id),formData.record=data.result.id,AppConnector.request(formData).done(function(data){form.hide(),progressIndicatorElement.progressIndicator({mode:"hide"}),aDeferred.resolve(data);}).fail(function(error,err){app.errorLog(error,err);});}}).fail(function(error,err){app.errorLog(error,err);}),aDeferred.promise()},registerCancelStepClickEvent:function registerCancelStepClickEvent(form){jQuery("button.cancelLink",form).on("click",function(){window.history.back();});},registerMarginCheckboxClickEvent:function registerMarginCheckboxClickEvent(container){container.find("#margin_chkbox").on("change",function(){var status=jQuery(this).is(":checked");status?container.find(".margin_inputs").addClass("d-none"):container.find(".margin_inputs").removeClass("d-none");});},registerModuleChangeEvent:function registerModuleChangeEvent(container){container.find("[name=\"module_name\"]").on("change",function(){var progressIndicator=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}});AppConnector.request({module:"PDF",parent:"Settings",view:"VariablePanel",record:container.find("[name=\"record\"]").val(),type:"pdf",selectedModule:$(this).val()}).done(function(response){container.find(".js-variable-panel").html(response),progressIndicator.progressIndicator({mode:"hide"});}).fail(function(error,err){progressIndicator.progressIndicator({mode:"hide"}),app.errorLog(error,err);});});},registerWatermarkTypeChange:function registerWatermarkTypeChange(container){var watermarkType=container.find("#watermark_type");watermarkType.on("change",function(){container.find(".watertext").toggleClass("d-none"),container.find(".waterimage").toggleClass("d-none");});},registerUploadButton:function registerUploadButton(form){form.find("#uploadWM").on("click",function(e){e.preventDefault();for(var file,fileSelect=form.find("#watermark_image"),files=fileSelect[0].files,formData=new FormData,i=0;i<files.length;i++)(file=files[i],!!file.type.match("image.*"))&&formData.append("watermark[]",file,file.name);formData.append("template_id",form.find("[name=\"record\"]").val());var xhr=new XMLHttpRequest;xhr.open("POST","index.php?module=PDF&parent=Settings&action=Watermark&mode=upload",!0),xhr.onload=function(){if(200===xhr.status){var response=JSON.parse(xhr.response);form.find("#watermark").html("<img src=\""+response.result.base64+"\" class=\"col-md-9\" />"),form.find("[name=\"watermark_image\"]").val(response.result.fileName),form.find("#deleteWM").removeClass("d-none");}},xhr.send(formData);});},registerDeleteUploadButton:function registerDeleteUploadButton(form){form.find("#deleteWM").on("click",function(e){e.preventDefault();var params={};params.data={parent:app.getParentModuleName(),module:app.getModuleName(),action:"Watermark",mode:"delete",id:form.find("[name=\"record\"]").val()},params.dataType="json",AppConnector.request(params).done(function(data){var response=data.result;response&&(form.find("#watermark").html(""),form.find("[name=\"watermark_image\"]").val(""),form.find("#deleteWM").addClass("d-none"));}).fail(function(data,err){app.errorLog(data,err);});});},registerEvents:function registerEvents(){var container=this.getContainer();container.find("[type=\"submit\"]").removeAttr("disabled");var opts=app.validationEngineOptions;opts.onValidationComplete=function(form,valid){return valid},opts.promptPosition="bottomRight",container.validationEngine(opts),this.registerCancelStepClickEvent(container),this.registerMarginCheckboxClickEvent(container),this.registerModuleChangeEvent(container),this.registerWatermarkTypeChange(container),this.registerUploadButton(container),this.registerDeleteUploadButton(container),App.Fields.Text.registerCopyClipboard(container);}});
//# sourceMappingURL=Edit1.min.js.map
