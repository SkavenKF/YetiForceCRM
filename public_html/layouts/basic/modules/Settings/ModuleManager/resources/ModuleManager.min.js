'use strict';

jQuery.Class('Settings_Module_Manager_Js',{validateField:function validateField(field){var specialChars=/[&\<\>\:\'\"\,]/;return !specialChars.test(field.val())||app.vtranslate('JS_SPECIAL_CHARACTERS_NOT_ALLOWED')},registerMondalCreateModule:function registerMondalCreateModule(data){data.find('[name="saveButton"]').attr('disabled',!0);var form=data.find('form');form.validationEngine(app.validationEngineOptions);var thisInstance=new Settings_Module_Manager_Js;data.find('input').on('change',function(){'module_name'==$(this).attr('name')?thisInstance.checkModuleName($(this).val(),data):''==$(this).val()?$(this).attr('check',!1):$(this).attr('check',!0);var status=!0;data.find('input[name]').each(function(){('false'==$(this).attr('check')||$(this).attr('check')==null)&&(status=!1);}),status?data.find('[name="saveButton"]').attr('disabled',!1):data.find('[name="saveButton"]').attr('disabled',!0);}),data.find('[name="saveButton"]').on('click',function(){if(form.validationEngine('validate')){data.find('[name="saveButton"]').attr('disabled',!0);var formData=form.serializeFormData(),progress=$.progressIndicator({message:app.vtranslate('Adding a Key'),blockInfo:{enabled:!0}}),params={};params.module=app.getModuleName(),params.parent=app.getParentModuleName(),params.action='Basic',params.mode='createModule',params.formData=formData,AppConnector.request(params).done(function(data){var result=data.result;result.success?window.location.href='index.php?parent=Settings&module=LayoutEditor&sourceModule='+result.text:(Vtiger_Helper_Js.showPnotify({text:result.text,type:'error'}),data.find('[name="saveButton"]').attr('disabled',!1));}),progress.progressIndicator({mode:'hide'});}});}},{updateModuleStatus:function updateModuleStatus(currentTarget){var aDeferred=jQuery.Deferred(),forModule=currentTarget.data('module'),status=currentTarget.is(':checked'),progressIndicatorElement=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}}),params={};return params.module=app.getModuleName(),params.parent=app.getParentModuleName(),params.updateStatus=status,params.forModule=forModule,params.action='Basic',params.mode='updateModuleStatus',AppConnector.request(params).done(function(data){progressIndicatorElement.progressIndicator({mode:'hide'}),aDeferred.resolve(data);}).fail(function(error){progressIndicatorElement.progressIndicator({mode:'hide'}),aDeferred.reject(error);}),aDeferred.promise()},createModule:function createModule(){var progressIndicatorElement=jQuery.progressIndicator();app.showModalWindow(null,'index.php?module=ModuleManager&parent=Settings&view=CreateModule',function(wizardContainer){progressIndicatorElement.progressIndicator({mode:'hide'}),Settings_Module_Manager_Js.registerMondalCreateModule(wizardContainer);});},checkModuleName:function checkModuleName(name,wizardContainer){var progressIndicatorElement=jQuery.progressIndicator();wizardContainer.find('[name="module_name"]').attr('check',!1);var params={};params.data={module:app.getModuleName(),action:'Basic',parent:app.getParentModuleName(),mode:'checkModuleName',moduleName:name},params.async=!1,params.dataType='json',AppConnector.request(params).done(function(data){var result=data.result;result.success?wizardContainer.find('[name="module_name"]').attr('check',!0):(wizardContainer.find('[name="module_name"]').attr('check',!1),Vtiger_Helper_Js.showPnotify({text:result.text,type:'error'}),wizardContainer.find('[name="saveButton"]').attr('disabled',!0)),progressIndicatorElement.progressIndicator({mode:'hide'});});},showNotify:function showNotify(customParams){var params={title:app.vtranslate('JS_MESSAGE'),text:'',type:'info'};$.extend(params,customParams),Vtiger_Helper_Js.showPnotify(params);},frameProgress:!1,deleteModule:function deleteModule(container){container.on('click','.deleteModule',function(e){var currentTarget=jQuery(e.currentTarget),forModule=currentTarget.attr('name'),params={};params.data={module:app.getModuleName(),action:'Basic',parent:app.getParentModuleName(),mode:'deleteModule',forModule:forModule},this.frameProgress=$.progressIndicator({position:'html',message:app.vtranslate('JS_FRAME_IN_PROGRESS'),blockInfo:{enabled:!0}}),AppConnector.request(params).done(function(){Vtiger_Helper_Js.showPnotify({title:app.vtranslate('JS_REMOVED_MODULE'),type:'info'}),window.location.href='index.php?module=ModuleManager&parent=Settings&view=List';});});},registerEvents:function registerEvents(){var thisInstance=this,container=jQuery('#moduleManagerContents');container.find('.createModule').on('click',thisInstance.createModule);var scrollbar=container.find('.js-scrollbar');app.showNewScrollbarTopBottom(scrollbar),thisInstance.deleteModule(container),container.on('click','[name="moduleStatus"]',function(e){var currentTarget=jQuery(e.currentTarget),moduleBlock=currentTarget.closest('.moduleManagerBlock'),actionButtons=moduleBlock.find('.actions'),forModule=currentTarget.data('moduleTranslation'),moduleDetails=moduleBlock.find('.moduleImage, .moduleName');currentTarget.is(':checked')?(actionButtons.removeClass('d-none'),moduleDetails.removeClass('dull'),thisInstance.updateModuleStatus(currentTarget).done(function(data){var params={text:forModule+' '+app.vtranslate('JS_MODULE_ENABLED')};!1==data.success&&(params.type='error',params.text=data.error.message),thisInstance.showNotify(params);})):(actionButtons.addClass('d-none'),moduleDetails.addClass('dull'),thisInstance.updateModuleStatus(currentTarget).done(function(){var params={text:forModule+' '+app.vtranslate('JS_MODULE_DISABLED')};thisInstance.showNotify(params);}));});}}),jQuery(document).ready(function(){var settingModuleManagerInstance=new Settings_Module_Manager_Js;settingModuleManagerInstance.registerEvents();});
//# sourceMappingURL=ModuleManager.min.js.map
