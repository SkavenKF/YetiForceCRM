'use strict';

var classCallCheck = function (instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
};

var createClass = function () {
  function defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      Object.defineProperty(target, descriptor.key, descriptor);
    }
  }

  return function (Constructor, protoProps, staticProps) {
    if (protoProps) defineProperties(Constructor.prototype, protoProps);
    if (staticProps) defineProperties(Constructor, staticProps);
    return Constructor;
  };
}();

var _extends = Object.assign || function (target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i];

    for (var key in source) {
      if (Object.prototype.hasOwnProperty.call(source, key)) {
        target[key] = source[key];
      }
    }
  }

  return target;
};

var Gantt=function(){function Gantt(container,projectData){classCallCheck(this,Gantt),this.container=$(container),this.registerLanguage(),this.options={style:{"tree-row-bar-polygon":{stroke:'#E74C3C00',"stroke-width":0,fill:'#F75C4C'},"tree-row-progress-bar-outline":{stroke:'#E74C3C00',"stroke-width":0},"header-title":{"max-width":'50%'}},title:{label:'Gantt',html:!1},taskList:{columns:[{id:1,label:app.vtranslate('JS_NO.','Project'),html:!0,value:'number',width:65,style:{"task-list-header-label":{"text-align":'center',width:'100%'},"task-list-item-value":{"text-align":'center',width:'100%'}}},{id:2,label:app.vtranslate('JS_NAME'),value:'label',width:280,expander:!0},{id:3,label:app.vtranslate('JS_PRIORITY'),value:'priority_label',width:70,style:{"task-list-header-label":{"text-align":'center',width:'100%'},"task-list-item-value":{"text-align":'center',width:'100%'}}},{id:3,label:app.vtranslate('JS_STATUS'),value:'status_label',width:100,style:{"task-list-header-label":{"text-align":'center',width:'100%'},"task-list-item-value":{"text-align":'center',width:'100%'}}},{id:4,label:app.vtranslate('JS_DURATION_SHORT','Project'),value:function value(task){return task.duration/24/60/60},width:45,style:{"task-list-header-label":{"text-align":'center',width:'100%'},"task-list-item-value":{"text-align":'center',width:'100%'}}},{id:5,label:app.vtranslate('JS_ASSIGNED','Project'),value:'assigned_user_name',width:150},{id:5,label:'%',value:'progress',width:35,style:{"task-list-header-label":{"text-align":'center',width:'100%'},"task-list-item-value":{"text-align":'center',width:'100%'}}}]},locale:{code:CONFIG.langKey,name:CONFIG.langKey,weekdays:[LANG.JS_MONDAY,LANG.JS_TUESDAY,LANG.JS_WEDNESDAY,LANG.JS_THURSDAY,LANG.JS_FRIDAY,LANG.JS_SATURDAY,LANG.JS_SUNDAY],weekdaysShort:[LANG.JS_MON,LANG.JS_TUE,LANG.JS_WED,LANG.JS_THU,LANG.JS_FRI,LANG.JS_SAT,LANG.JS_SUN],weekdaysMin:[LANG.JS_MON,LANG.JS_TUE,LANG.JS_WED,LANG.JS_THU,LANG.JS_FRI,LANG.JS_SAT,LANG.JS_SUN],months:[LANG.JS_JANUARY,LANG.JS_FEBRUARY,LANG.JS_MARCH,LANG.JS_APRIL,LANG.JS_MAY,LANG.JS_JUNE,LANG.JS_JULY,LANG.JS_AUGUST,LANG.JS_SEPTEMBER,LANG.JS_NOVEMBER,LANG.JS_OCTOBER,LANG.JS_DECEMBER],monthsShort:[LANG.JS_JAN,LANG.JS_FEB,LANG.JS_MAR,LANG.JS_APR,LANG.JS_MAY,LANG.JS_JUN,LANG.JS_JUL,LANG.JS_AUG,LANG.JS_SEP,LANG.JS_NOV,LANG.JS_OCT,LANG.JS_DEC],ordinal:function ordinal(n){return ''+n}}},'undefined'!=typeof projectData&&(this.options.title.label=projectData,this.loadProject(projectData));}return createClass(Gantt,[{key:'registerLanguage',value:function registerLanguage(){}},{key:'getBranchesWithStatus',value:function getBranchesWithStatus(moduleName,statuses,current){current=_extends({},current);var children=[];current.children=current.children.map(function(task){return task});var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,task,_iterator=current.children[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)task=_step.value,children.push(this.getBranchesWithStatus(moduleName,statuses,task));}catch(err){_didIteratorError=!0,_iteratorError=err;}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return();}finally{if(_didIteratorError)throw _iteratorError}}return current.children=children,current}},{key:'filterProjectData',value:function filterProjectData(projectData){var newProjectData=Object.assign({},projectData),tree=this.makeTree(newProjectData.tasks);for(var moduleName in this.filter.status)this.filter.status.hasOwnProperty(moduleName)&&(tree=this.getBranchesWithStatus(moduleName,this.filter.status[moduleName],tree));return newProjectData.tasks=this.flattenTree(tree),newProjectData}},{key:'loadProject',value:function loadProject(projectData){return this.projectData=projectData,this.allTasks=this.projectData.tasks,this.options.title.label=projectData.title,'undefined'==typeof this.allTasks?($('.js-hide-filter').addClass('d-none'),void $('.js-show-add-record').removeClass('d-none')):void(this.statuses=this.projectData.statuses,this.filter={status:this.projectData.activeStatuses},this.container.closest('form').on('submit',function(ev){return ev.preventDefault(),ev.stopPropagation(),!1}),GanttElastic.mount({el:'#'+this.container.attr('id'),tasks:this.allTasks,options:this.options}))}},{key:'loadProjectFromAjax',value:function loadProjectFromAjax(params){var _this=this,progressInstance=jQuery.progressIndicator({blockInfo:{enabled:!0}});AppConnector.request(params).done(function(response){_this.loadProject(response.result),progressInstance.progressIndicator({mode:'hide'});});}},{key:'reloadData',value:function reloadData(data){this.gantt.loadProject(data);}},{key:'saveFilter',value:function saveFilter(filterOptions){this.filter=filterOptions,this.reloadData(this.filterProjectData(this.projectData));}},{key:'getStatusFromValue',value:function getStatusFromValue(value,moduleName){var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,status,_iterator2=this.statuses[moduleName][Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0)if(status=_step2.value,status.value===value)return Object.assign({},status)}catch(err){_didIteratorError2=!0,_iteratorError2=err;}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return();}finally{if(_didIteratorError2)throw _iteratorError2}}app.errorLog('Status not found ['+value+']');}},{key:'showFiltersModal',value:function showFiltersModal(){var _this2=this,self=this,box=bootbox.dialog({show:'false',message:'<div class="js-gantt__filter-modal form" data-js="container">\n\t\t\t\t<div class="form-group">\n\t\t\t\t\t<label>'+app.vtranslate('JS_PROJECT_STATUSES','Project')+':</label>\n\t\t\t\t\t<select class="select2 form-control" id="js-gantt__filter-project" multiple>\n\t\t\t\t\t\t'+self.statuses.Project.map(function(status){return '<option value="'+status.value+'" '+(0<=_this2.filter.status.Project.map(function(status){return status.value}).indexOf(status.value)?'selected':'')+'>'+status.label+'</option>'})+'\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="form-group">\n\t\t\t\t<label>'+app.vtranslate('JS_MILESTONE_STATUSES','Project')+':</label>\n\t\t\t\t\t<select class="select2 form-control" id="js-gantt__filter-milestone" multiple>\n\t\t\t\t\t\t'+self.statuses.ProjectMilestone.map(function(status){return '<option value="'+status.value+'" '+(0<=_this2.filter.status.ProjectMilestone.map(function(status){return status.value}).indexOf(status.value)?'selected':'')+'>'+status.label+'</option>'})+'\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="form-group">\n\t\t\t\t<label>'+app.vtranslate('JS_TASK_STATUSES','Project')+':</label>\n\t\t\t\t\t<select class="select2 form-control" id="js-gantt__filter-task" multiple>\n\t\t\t\t\t\t'+self.statuses.ProjectTask.map(function(status){return '<option value="'+status.value+'" '+(0<=_this2.filter.status.ProjectTask.map(function(status){return status.value}).indexOf(status.value)?'selected':'')+'>'+status.label+'</option>'})+'\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t</div>',title:'<span class="fas fa-filter"></span> '+app.vtranslate('JS_FILTER_BY_STATUSES','Project'),buttons:{success:{label:'<span class="fas fa-check mr-1"></span>'+app.vtranslate('JS_UPDATE_GANTT','Project'),className:'btn-success',callback:function callback(){self.saveFilter({status:{Project:$('#js-gantt__filter-project',this).val().map(function(status){return self.getStatusFromValue(status,'Project')}),ProjectMilestone:$('#js-gantt__filter-milestone',this).val().map(function(status){return self.getStatusFromValue(status,'ProjectMilestone')}),ProjectTask:$('#js-gantt__filter-task',this).val().map(function(status){return self.getStatusFromValue(status,'ProjectTask')})}});}},danger:{label:'<span class="fas fa-times mr-1"></span>'+app.vtranslate('JS_CANCEL'),className:'btn-danger',callback:function callback(){}}}});App.Fields.Picklist.showSelect2ElementView($(box).find('.select2')),box.show();}},{key:'registerEvents',value:function registerEvents(){var container=this.container;container.find('.js-gantt__front-filter').on('click',function(e){e.preventDefault(),self.showFiltersModal();}),container.find('[data-toggle="tooltip"]').tooltip();}}]),Gantt}();
//# sourceMappingURL=Gantt.min.js.map
